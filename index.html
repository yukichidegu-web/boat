<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1ã‚³ãƒ¼ã‚¹ç‰¹åŒ–ãƒ»æœŸå¾…å€¤æœ€å¤§åŒ–</title>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,sans-serif; background:#f4f4f4; padding:16px; }
h2,h3 { margin-bottom:10px; }
.box { background:#fff; padding:16px; border-radius:12px; margin-bottom:14px; }
label { font-weight:bold; display:block; margin-top:8px; }
input,select { width:100%; padding:10px; font-size:16px; margin-top:4px; }
button { width:100%; padding:14px; font-size:18px; border:none; border-radius:10px; margin-top:10px; }
.buy { background:#16a34a; color:#fff; }
.skip { background:#2563eb; color:#fff; }
.ng { color:#dc2626; font-weight:bold; }
.ok { color:#16a34a; font-weight:bold; }
table { width:100%; border-collapse:collapse; margin-top:8px; }
th,td { border-bottom:1px solid #ddd; padding:6px; font-size:14px; text-align:center; }
.small { font-size:14px; color:#555; }
</style>
</head>
<body>

<h2>ğŸš¤ 1ã‚³ãƒ¼ã‚¹ç‰¹åŒ–ãƒ»æœŸå¾…å€¤æœ€å¤§åŒ–</h2>

<div class="box">
<label>é–‹å‚¬å ´</label>
<select id="place">
  <option value="ok">ä½ä¹‹æ±Ÿ / èŠ¦å±‹ / å¤§æ‘</option>
  <option value="ng">ãã®ä»–</option>
</select>

<label>é€²å…¥</label>
<select id="entry">
  <option value="ok">æ ãªã‚Š</option>
  <option value="ng">å´©ã‚Œæƒ³å®š</option>
</select>

<label>1å·è‰‡ å±•ç¤ºã‚¿ã‚¤ãƒ </label>
<input type="number" step="0.01" id="t1">

<label>å±•ç¤º1ä½ ã‚¿ã‚¤ãƒ ï¼ˆFãªã—æœ€é€Ÿï¼‰</label>
<input type="number" step="0.01" id="tTop">

<label>1â†’2 ã‚ªãƒƒã‚º</label>
<input type="number" step="0.1" id="odds12">

<label>1â†’3 ã‚ªãƒƒã‚º</label>
<input type="number" step="0.1" id="odds13">

<button onclick="judge()">åˆ¤å®š</button>
<div id="result"></div>
</div>

<div class="box">
<h3>ğŸ“Š ä»Šæœˆã®åæ”¯</h3>
<div id="summary"></div>
</div>

<div class="box">
<h3>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™</h3>
<div id="stats"></div>
</div>

<div class="box">
<h3>ğŸ—‚ å±¥æ­´</h3>
<table>
<thead>
<tr><th>æ—¥ä»˜</th><th>åˆ¤å®š</th><th>æŠ•è³‡</th><th>å›å</th></tr>
</thead>
<tbody id="history"></tbody>
</table>
<button onclick="exportCSV()">CSVå‡ºåŠ›</button>
</div>

<script>
const BET = 1000;
const STORAGE_KEY = "boat_tool_data";

function monthKey(){
  const d=new Date();
  return d.getFullYear()+"-"+(d.getMonth()+1);
}
function load(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
}
function save(d){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(d));
}

function judge(){
  const t1=+t1El.value, tTop=+tTopEl.value;
  const o12=+odds12El.value, o13=+odds13El.value;
  let reasons=[];

  if(placeEl.value==="ng") reasons.push("å ´NG");
  if(entryEl.value==="ng") reasons.push("é€²å…¥NG");
  if(Math.abs(t1-tTop)>0.10) reasons.push("å±•ç¤ºå·®NG");
  if(o12<6 && o13<6) reasons.push("ã‚ªãƒƒã‚ºä¸è¶³");
  if(o12<3.5) reasons.push("1â†’2å£²ã‚Œã™ã");

  recordDecision(reasons.length===0);

  if(reasons.length){
    result.innerHTML=`<p class="ng">ğŸ”µ è¦‹é€ã‚Š<br>${reasons.join("ãƒ»")}</p>`;
    return;
  }

  let bets=[];
  if(o12>=6) bets.push(o12);
  if(o13>=6) bets.push(o13);

  result.innerHTML=`
    <p class="ok">ğŸŸ¢ è²·ã„ï¼ˆ${bets.length}ç‚¹ï¼‰</p>
    <button class="buy" onclick='recordResult(true,${JSON.stringify(bets)})'>çš„ä¸­</button>
    <button class="ng" onclick='recordResult(false,${JSON.stringify(bets)})'>ä¸çš„ä¸­</button>
  `;
}

function recordDecision(buy){
  const d=load();
  d.push({month:monthKey(),decision:buy});
  save(d);
}

function recordResult(hit,bets){
  const d=load();
  const invest=bets.length*BET;
  const pay=hit?Math.max(...bets)*BET:0;
  d.push({month:monthKey(),invest,pay});
  save(d);
  render();
}

function render(){
  const d=load().filter(x=>x.month===monthKey());
  let invest=0,pay=0,buy=0,hit=0,judge=0;

  history.innerHTML="";
  d.forEach(x=>{
    if("decision" in x){
      judge++;
      if(x.decision) buy++;
    }
    if("invest" in x){
      invest+=x.invest; pay+=x.pay;
      if(x.pay>0) hit++;
      history.innerHTML+=`<tr><td>-</td><td>${x.pay>0?"çš„ä¸­":"ä¸çš„ä¸­"}</td><td>${x.invest}</td><td>${x.pay}</td></tr>`;
    }
  });

  summary.innerHTML=`
    æŠ•è³‡ï¼š${invest}å††<br>
    å›åï¼š${pay}å††<br>
    <b>åæ”¯ï¼š${pay-invest}å††</b>
  `;

  stats.innerHTML=`
    åˆ¤å®šæ•°ï¼š${judge}<br>
    è²·ã„æ•°ï¼š${buy}<br>
    è²·ã„ç‡ï¼š${judge?((buy/judge)*100).toFixed(1):0}%<br><br>
    çš„ä¸­æ•°ï¼š${hit}<br>
    çš„ä¸­ç‡ï¼š${buy?((hit/buy)*100).toFixed(1):0}%
  `;
}

function exportCSV(){
  const d=load();
  let csv="month,decision,invest,pay\n";
  d.forEach(x=>{
    csv+=`${x.month},${x.decision??""},${x.invest??""},${x.pay??""}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="boat_result.csv";
  a.click();
}

const placeEl=document.getElementById("place");
const entryEl=document.getElementById("entry");
const t1El=document.getElementById("t1");
const tTopEl=document.getElementById("tTop");
const odds12El=document.getElementById("odds12");
const odds13El=document.getElementById("odds13");
const result=document.getElementById("result");
const summary=document.getElementById("summary");
const history=document.getElementById("history");
const stats=document.getElementById("stats");

render();
</script>

</body>
</html>