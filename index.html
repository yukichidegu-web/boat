<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ボートレース EV＋的中率表示ツール</title>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f2f2f2;
  margin:0;
  padding:12px;
}
.container{
  background:#fff;
  border-radius:10px;
  padding:14px;
}
h1{font-size:18px;margin-bottom:8px;}
select,textarea,button{
  width:100%;
  font-size:14px;
  margin-top:8px;
}
textarea{height:160px;}
button{padding:12px;font-size:16px;}
.result{
  margin-top:12px;
  background:#eef;
  padding:10px;
  border-radius:8px;
}
.buy{color:#c00;font-weight:bold;}
.skip{color:#555;font-weight:bold;}
.rate{
  margin-top:6px;
  font-size:14px;
}
</style>
</head>
<body>

<div class="container">
<h1>ボートレース 判定＋的中率</h1>

<select id="place"></select>

<textarea id="input" placeholder=".21 6.70
.13 6.74
F.02 6.74

.09 6.69
.00 6.64"></textarea>

<button onclick="analyze()">判定する</button>
<button onclick="clearAll()">入力クリア</button>

<div id="output" class="result"></div>
</div>

<script>
// --- 場別係数（全24場） ---
const places={
  kiryu:{name:"桐生",st:1.4,time:0.8},
  toda:{name:"戸田",st:1.3,time:0.9},
  edogawa:{name:"江戸川",st:1.2,time:1.0},
  heiwajima:{name:"平和島",st:1.0,time:1.1},
  tamagawa:{name:"多摩川",st:0.9,time:1.2},
  hamanako:{name:"浜名湖",st:1.1,time:1.0},
  gamagori:{name:"蒲郡",st:1.2,time:0.9},
  tokoname:{name:"常滑",st:1.1,time:1.0},
  tsu:{name:"津",st:1.0,time:1.1},
  mikuni:{name:"三国",st:1.2,time:0.9},
  biwako:{name:"びわこ",st:1.0,time:1.1},
  suminoe:{name:"住之江",st:1.0,time:1.0},
  amagasaki:{name:"尼崎",st:1.1,time:1.0},
  naruto:{name:"鳴門",st:1.2,time:0.9},
  marugame:{name:"丸亀",st:1.3,time:0.8},
  kojima:{name:"児島",st:1.1,time:1.0},
  miyajima:{name:"宮島",st:1.0,time:1.1},
  tokuyama:{name:"徳山",st:1.1,time:1.0},
  shimonoseki:{name:"下関",st:1.2,time:0.9},
  wakamatsu:{name:"若松",st:1.3,time:0.8},
  ashiy:{name:"芦屋",st:0.9,time:1.2},
  fukuoka:{name:"福岡",st:1.0,time:1.0},
  karatsu:{name:"唐津",st:1.1,time:1.0},
  omura:{name:"大村",st:0.8,time:1.4}
};

// セレクト生成
const sel=document.getElementById("place");
Object.keys(places).forEach(k=>{
  const o=document.createElement("option");
  o.value=k;
  o.textContent=places[k].name;
  sel.appendChild(o);
});

function analyze(){
  const coef=places[sel.value];
  const raw=document.getElementById("input").value.split("\n");
  let boats=[];

  raw.forEach(l=>{
    l=l.trim(); if(!l) return;
    let f=false;
    if(l.startsWith("F")){f=true;l=l.replace("F","");}
    const p=l.split(/\s+/); if(p.length!==2) return;
    boats.push({num:boats.length+1,st:+p[0],time:+p[1],f});
  });

  if(boats.length<2){
    out("入力不足");
    return;
  }

  // スコア計算
  boats.forEach(b=>{
    b.score=(0.30-b.st)*10*coef.st+(6.80-b.time)*20*coef.time-(b.f?5:0);
  });

  boats.sort((a,b)=>b.score-a.score);
  const axis=boats[0];

  let reasons=[`軸：${axis.num}号艇（ST ${axis.st.toFixed(2)} 展示 ${axis.time.toFixed(2)}）`];
  let buy=true;

  if(boats.filter(b=>b.f).length>=2){
    reasons.push("F持ち複数で荒れ警戒");
    buy=false;
  }

  // 的中率計算用
  const totalScore=boats.reduce((s,b)=>s+b.score,0);
  const pWin=axis.score/totalScore;

  let html="";
  if(buy){
    html+=`<div class="buy">▶ BUY</div>`;
    html+=`<div>買い目（2連単）</div>`;

    let missProb=1;
    boats.slice(1,4).forEach(b=>{
      const pSecond=b.score/(totalScore-axis.score);
      const pHit=pWin*pSecond;
      missProb*=1-pHit;

      html+=`<div>
        ${axis.num}-${b.num}
        （的中率 ${(pHit*100).toFixed(1)}%）
      </div>`;
    });

    const totalHit=1-missProb;
    html+=`<div class="rate"><b>合算的中率：${(totalHit*100).toFixed(1)}%</b></div>`;
  }else{
    html+=`<div class="skip">▶ SKIP</div>`;
  }

  html+=`<div>理由：<br>・${reasons.join("<br>・")}</div>`;
  out(html);
}

function out(t){
  document.getElementById("output").innerHTML=t;
}
function clearAll(){
  document.getElementById("input").value="";
  document.getElementById("output").innerHTML="";
}
</script>

</body>
</html>